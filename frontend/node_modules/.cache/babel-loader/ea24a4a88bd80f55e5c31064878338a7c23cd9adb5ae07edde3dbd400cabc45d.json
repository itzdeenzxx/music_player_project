{"ast":null,"code":"import axios from 'axios';\nimport { EventBus } from \"../event-bus\";\naxios.defaults.withCredentials = true;\nexport default {\n  name: 'ProductShow',\n  data() {\n    return {\n      products: [],\n      id: null,\n      memEmail: null,\n      cartId: null,\n      backendMessage: ''\n    };\n  },\n  mounted() {\n    this.id = this.$route.params.pd_id;\n    this.fetchProduct();\n  },\n  methods: {\n    async fetchProduct() {\n      try {\n        const response = await axios.get(`http://localhost:3000/products/${this.id}`);\n        this.products = response.data;\n      } catch (err) {\n        console.error(err);\n        alert('Failed to load product data.');\n      }\n    },\n    async chkLogin() {\n      await this.chkSession();\n      if (!this.memEmail) {\n        alert(\"ต้อง Login เข้าระบบก่อน\");\n        return;\n      }\n      await this.chkCart();\n      if (!this.cartId) {\n        await this.addCart();\n      }\n      this.addCartDtl();\n    },\n    async chkSession() {\n      try {\n        const response = await axios.get(`http://localhost:3000/members/getss`);\n        this.memEmail = response.data.email;\n      } catch (err) {\n        console.error(err);\n        alert('Session check failed.');\n      }\n    },\n    async addCart() {\n      try {\n        const customer = {\n          cusId: this.memEmail\n        };\n        const response = await axios.post(`http://localhost:3000/carts/addcart`, customer);\n        this.backendMessage = response.data.messageAddCart;\n        this.cartId = response.data.messageAddCart;\n      } catch (err) {\n        console.error(err);\n        alert('Failed to create cart.');\n      }\n    },\n    async chkCart() {\n      try {\n        const response = await axios.get(`http://localhost:3000/carts/chkcart`);\n        this.cartId = response.data.id;\n      } catch (err) {\n        console.error(err);\n        alert('Failed to check cart.');\n      }\n    },\n    async addCartDtl() {\n      const cartdtl = {\n        cartId: this.cartId,\n        pdId: this.id,\n        pdPrice: this.products[0].pd_price\n      };\n      try {\n        const response = await axios.post(`http://localhost:3000/carts/addcartdtl`, cartdtl);\n        EventBus.emit('cartdtlOK');\n        this.backendMessage = response.data.messageAddCartDtl;\n      } catch (err) {\n        console.error(err);\n        alert('Failed to add product to cart.');\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","EventBus","defaults","withCredentials","name","data","products","id","memEmail","cartId","backendMessage","mounted","$route","params","pd_id","fetchProduct","methods","response","get","err","console","error","alert","chkLogin","chkSession","chkCart","addCart","addCartDtl","email","customer","cusId","post","messageAddCart","cartdtl","pdId","pdPrice","pd_price","emit","messageAddCartDtl"],"sources":["/Users/addeen/Desktop/frontend/kushop/src/components/ProductShow.vue"],"sourcesContent":["<template>\r\n    <div v-for=\"(pd, pd_id) in products\" :key=\"pd_id\" class=\"mt-5\">\r\n        <div class=\"row\">\r\n            <div class=\"col-md-6 col-sm-12\">\r\n                <div class=\"card mx-auto\" style=\"width: 18rem\">\r\n                    <img :src=\"`http://localhost:3000/img_pd/${pd.pd_id}.jpg`\" alt=\"\">\r\n                </div>\r\n            </div>\r\n            <div class=\"col-md-6 col-sm-12\">\r\n                <table class=\"table\">\r\n                    <tr class=\"table-secondary\">\r\n                        <td><h4>{{ pd.pd_id }}</h4></td>\r\n                        <td><h4>{{ pd.pd_name }}</h4></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><h5>ราคา</h5></td>\r\n                        <td><h5>{{ pd.pd_price }}</h5></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><h5>ยี่ห้อ</h5></td>\r\n                        <td><h5>{{ pd.thebrand.brand_name }}</h5></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td><h5>รายละเอียด</h5></td>\r\n                        <td><h5>{{ pd.pd_remark }}</h5></td>\r\n                    </tr>\r\n                </table>\r\n                <button class=\"btn btn-primary\" @click=\"chkLogin\">\r\n                    <i class=\"bi bi-cart lead\"></i> ใส่ตะกร้า&nbsp;\r\n                </button>\r\n                <button class=\"btn btn-warning float-end\">\r\n                    <i class=\"bi bi-pencil-fill lead\"></i> แก้ไข&nbsp;&nbsp;\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nimport { EventBus } from \"../event-bus\";\r\n\r\naxios.defaults.withCredentials = true;\r\n\r\nexport default {\r\n    name: 'ProductShow',\r\n    data() {\r\n        return {\r\n            products: [],\r\n            id: null,\r\n            memEmail: null,\r\n            cartId: null,\r\n            backendMessage: ''\r\n        };\r\n    },\r\n    mounted() {\r\n        this.id = this.$route.params.pd_id;\r\n        this.fetchProduct();\r\n    },\r\n    \r\n    methods: {\r\n        async fetchProduct() {\r\n            try {\r\n                const response = await axios.get(`http://localhost:3000/products/${this.id}`);\r\n                this.products = response.data;\r\n            } catch (err) {\r\n                console.error(err);\r\n                alert('Failed to load product data.');\r\n            }\r\n        },\r\n\r\n        async chkLogin() {\r\n            await this.chkSession();\r\n            if (!this.memEmail) {\r\n                alert(\"ต้อง Login เข้าระบบก่อน\");\r\n                return;\r\n            }\r\n            await this.chkCart();\r\n            if (!this.cartId) {\r\n                await this.addCart();\r\n            }\r\n            this.addCartDtl();\r\n        },\r\n\r\n        async chkSession() {\r\n            try {\r\n                const response = await axios.get(`http://localhost:3000/members/getss`);\r\n                this.memEmail = response.data.email;\r\n            } catch (err) {\r\n                console.error(err);\r\n                alert('Session check failed.');\r\n            }\r\n        },\r\n\r\n        async addCart() {\r\n            try {\r\n                const customer = { cusId: this.memEmail };\r\n                const response = await axios.post(`http://localhost:3000/carts/addcart`, customer);\r\n                this.backendMessage = response.data.messageAddCart;\r\n                this.cartId = response.data.messageAddCart;\r\n            } catch (err) {\r\n                console.error(err);\r\n                alert('Failed to create cart.');\r\n            }\r\n        },\r\n\r\n        async chkCart() {\r\n            try {\r\n                const response = await axios.get(`http://localhost:3000/carts/chkcart`);\r\n                this.cartId = response.data.id;\r\n            } catch (err) {\r\n                console.error(err);\r\n                alert('Failed to check cart.');\r\n            }\r\n        },\r\n\r\n        async addCartDtl() {\r\n            const cartdtl = {\r\n                cartId: this.cartId,\r\n                pdId: this.id,\r\n                pdPrice: this.products[0].pd_price\r\n            };\r\n            try {\r\n                const response = await axios.post(`http://localhost:3000/carts/addcartdtl`, cartdtl);\r\n                EventBus.emit('cartdtlOK');\r\n                this.backendMessage = response.data.messageAddCartDtl;\r\n            } catch (err) {\r\n                console.error(err);\r\n                alert('Failed to add product to cart.');\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n/* Add relevant styles here */\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}