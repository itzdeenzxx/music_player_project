{"ast":null,"code":"import axios from 'axios'; //1.import axios มาใช้งาน\naxios.defaults.withCredentials = true;\nexport default {\n  name: \"PageMember\",\n  data() {\n    return {\n      memEmail: null,\n      memName: null,\n      dutyId: null,\n      imageExists: false,\n      fileMessage: null,\n      file: null,\n      imageTimestamp: Date.now() // ใช้เป็น query parameter\n    };\n  },\n  async mounted() {\n    await this.chkSession();\n    this.checkImage();\n  },\n  methods: {\n    // อ่านค่าจาก input file เมื่อถูกเรียก\n    onFileChange(e) {\n      this.file = e.target.files[0];\n    },\n    // ทำการ Uploadfile เมื่อถูกSubmit\n    async uploadFile() {\n      if (!this.file) {\n        this.fileMessage = \"เลือก File ก่อน\";\n        return;\n      }\n      // อ่านค่าจาก Form เพื่อ POST\n      const formData = new FormData();\n      formData.append(\"file\", this.file);\n      // กำหนด endpoint และกำหนด Header ว่าเป็นการส่ง file\n      try {\n        const response = await axios.post(\"http://localhost:3000/users/uploadImg\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\"\n          }\n        });\n        this.fileMessage = response.data.message;\n        // ให้ทำการตรวจสอบ image อีกครั้ง\n        this.checkImage();\n        this.imageTimestamp = Date.now();\n      } catch (err) {\n        this.fileMessage = \"fail\";\n      }\n    },\n    async chkSession() {\n      await axios.get(`http://localhost:3000/users/getss`).then(res => {\n        console.log(res.data);\n        this.memEmail = res.data.email;\n        this.memName = res.data.name;\n        this.dutyId = res.data.duty;\n      }).catch(err => {\n        console.error(err);\n      });\n    },\n    checkImage() {\n      const image = new Image();\n      image.src = `http://localhost:3000/users/${this.memEmail}.jpg`;\n      image.onload = () => {\n        // รูปภาพโหลดสำเร็จ\n        this.imageExists = true;\n      };\n      image.onerror = () => {\n        // รูปภาพไม่สามารถโหลดได้\n        this.imageExists = false;\n      };\n    }\n  }\n};","map":{"version":3,"names":["axios","defaults","withCredentials","name","data","memEmail","memName","dutyId","imageExists","fileMessage","file","imageTimestamp","Date","now","mounted","chkSession","checkImage","methods","onFileChange","e","target","files","uploadFile","formData","FormData","append","response","post","headers","message","err","get","then","res","console","log","email","duty","catch","error","image","Image","src","onload","onerror"],"sources":["/Users/addeen/Desktop/project/frontend/src/components/PageMember.vue"],"sourcesContent":["<template>\r\n    <div>\r\n    <div class=\"row \">\r\n        <div class=\"col-md-6 col-sm-12 \">\r\n            <h3 class=\"mt-5 text-end\">{{ memEmail }}</h3>\r\n            <h5 class=\"text-end\">{{ memName }}</h5>\r\n        </div>\r\n        <div class=\"col-md-6 col-sm-12 \">\r\n            <div class=\"card mt-5\" style=\"width: 18rem\" v-if=\"imageExists\">\r\n                <img :src=\"`http://localhost:3000/img_mem/${memEmail}.jpg?timestamp=${imageTimestamp}`\"\r\n            :alt=\"memEmail\">\r\n            </div>\r\n            <div class=\"card mt-5\" style=\"width: 18rem\" v-else>\r\n                <img :src=\"`http://localhost:3000/img_mem/${memEmail}.jpg`\" :alt=\"memEmail\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <form @submit.prevent=\"uploadFile\">\r\n        <div class=\"row g-3 mt-3\">\r\n            <div class=\"col-md-6 col-sm-12 \"></div>\r\n            <div class=\"col-auto\">\r\n                <input class=\"form-control\" type=\"file\" id=\"formFile\" @change=\"onFileChange\" required />\r\n            </div>\r\n            <div class=\"col-auto\">\r\n                <button class=\"btn btn-primary\" type=\"submit\">Upload</button>\r\n            </div>\r\n        </div>\r\n        <div class=\"row g-3 mt-3\">\r\n            <div class=\"col-md-6 col-sm-12 \">\r\n            </div>\r\n            <div class=\"col-auto\">\r\n                <div class=\"alert alert-success\" v-if=\"fileMessage != 'fail' && fileMessage != null\">\r\n                {{ fileMessage }}\r\n                </div>\r\n            </div>\r\n            <div class=\"col-auto\"></div>\r\n        </div>\r\n    </form>\r\n</div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport axios from 'axios' //1.import axios มาใช้งาน\r\naxios.defaults.withCredentials = true\r\nexport default {\r\n    name: \"PageMember\",\r\n    data() {\r\n        return {\r\n            memEmail: null,\r\n            memName: null,\r\n            dutyId: null,\r\n            imageExists:false,\r\n            fileMessage: null,\r\n            file: null,\r\n            imageTimestamp: Date.now(), // ใช้เป็น query parameter\r\n\r\n        }\r\n    }, async mounted() {\r\n    await this.chkSession();\r\n    this.checkImage()\r\n  },\r\n    methods: { \r\n        // อ่านค่าจาก input file เมื่อถูกเรียก\r\n        onFileChange(e) {\r\n        this.file = e.target.files[0];\r\n        },\r\n        // ทำการ Uploadfile เมื่อถูกSubmit\r\n        async uploadFile() {\r\n        if (!this.file) {\r\n            this.fileMessage = \"เลือก File ก่อน\";\r\n            return;\r\n        }\r\n        // อ่านค่าจาก Form เพื่อ POST\r\n        const formData = new FormData();\r\n        formData.append(\"file\", this.file);\r\n        // กำหนด endpoint และกำหนด Header ว่าเป็นการส่ง file\r\n        try {\r\n            const response = await axios.post(\r\n            \"http://localhost:3000/users/uploadImg\",formData,\r\n            {\r\n                headers: {\r\n                \"Content-Type\": \"multipart/form-data\",\r\n                },\r\n            }\r\n            );\r\n            this.fileMessage = response.data.message;\r\n            // ให้ทำการตรวจสอบ image อีกครั้ง\r\n            this.checkImage();\r\n            this.imageTimestamp = Date.now();\r\n        } catch (err) {\r\n            this.fileMessage = \"fail\";\r\n        }\r\n        },\r\n        async chkSession() {\r\n            await axios.get(`http://localhost:3000/users/getss`)\r\n                .then(res => {\r\n                    console.log(res.data)\r\n                    this.memEmail = res.data.email\r\n                    this.memName = res.data.name\r\n                    this.dutyId = res.data.duty\r\n                    \r\n                })\r\n                .catch(err => {\r\n                    console.error(err);\r\n                });\r\n        },\r\n        checkImage() {\r\n            const image = new Image();\r\n            image.src = `http://localhost:3000/users/${this.memEmail}.jpg`;\r\n            image.onload = () => {\r\n                // รูปภาพโหลดสำเร็จ\r\n                this.imageExists = true;\r\n            };\r\n            image.onerror = () => {\r\n                // รูปภาพไม่สามารถโหลดได้\r\n                this.imageExists = false;\r\n            };\r\n        },\r\n        \r\n    }\r\n}\r\n</script>\r\n\r\n\r\n<style></style>\r\n"],"mappings":"AA2CA,OAAOA,KAAI,MAAO,OAAM,EAAE;AAC1BA,KAAK,CAACC,QAAQ,CAACC,eAAc,GAAI,IAAG;AACpC,eAAe;EACXC,IAAI,EAAE,YAAY;EAClBC,IAAIA,CAAA,EAAG;IACH,OAAO;MACHC,QAAQ,EAAE,IAAI;MACdC,OAAO,EAAE,IAAI;MACbC,MAAM,EAAE,IAAI;MACZC,WAAW,EAAC,KAAK;MACjBC,WAAW,EAAE,IAAI;MACjBC,IAAI,EAAE,IAAI;MACVC,cAAc,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE;IAEhC;EACJ,CAAC;EAAE,MAAMC,OAAOA,CAAA,EAAG;IACnB,MAAM,IAAI,CAACC,UAAU,CAAC,CAAC;IACvB,IAAI,CAACC,UAAU,CAAC;EAClB,CAAC;EACCC,OAAO,EAAE;IACL;IACAC,YAAYA,CAACC,CAAC,EAAE;MAChB,IAAI,CAACT,IAAG,GAAIS,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;IAC7B,CAAC;IACD;IACA,MAAMC,UAAUA,CAAA,EAAG;MACnB,IAAI,CAAC,IAAI,CAACZ,IAAI,EAAE;QACZ,IAAI,CAACD,WAAU,GAAI,iBAAiB;QACpC;MACJ;MACA;MACA,MAAMc,QAAO,GAAI,IAAIC,QAAQ,CAAC,CAAC;MAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAE,IAAI,CAACf,IAAI,CAAC;MAClC;MACA,IAAI;QACA,MAAMgB,QAAO,GAAI,MAAM1B,KAAK,CAAC2B,IAAI,CACjC,uCAAuC,EAACJ,QAAQ,EAChD;UACIK,OAAO,EAAE;YACT,cAAc,EAAE;UAChB;QACJ,CACA,CAAC;QACD,IAAI,CAACnB,WAAU,GAAIiB,QAAQ,CAACtB,IAAI,CAACyB,OAAO;QACxC;QACA,IAAI,CAACb,UAAU,CAAC,CAAC;QACjB,IAAI,CAACL,cAAa,GAAIC,IAAI,CAACC,GAAG,CAAC,CAAC;MACpC,EAAE,OAAOiB,GAAG,EAAE;QACV,IAAI,CAACrB,WAAU,GAAI,MAAM;MAC7B;IACA,CAAC;IACD,MAAMM,UAAUA,CAAA,EAAG;MACf,MAAMf,KAAK,CAAC+B,GAAG,CAAC,mCAAmC,EAC9CC,IAAI,CAACC,GAAE,IAAK;QACTC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC7B,IAAI;QACpB,IAAI,CAACC,QAAO,GAAI4B,GAAG,CAAC7B,IAAI,CAACgC,KAAI;QAC7B,IAAI,CAAC9B,OAAM,GAAI2B,GAAG,CAAC7B,IAAI,CAACD,IAAG;QAC3B,IAAI,CAACI,MAAK,GAAI0B,GAAG,CAAC7B,IAAI,CAACiC,IAAG;MAE9B,CAAC,EACAC,KAAK,CAACR,GAAE,IAAK;QACVI,OAAO,CAACK,KAAK,CAACT,GAAG,CAAC;MACtB,CAAC,CAAC;IACV,CAAC;IACDd,UAAUA,CAAA,EAAG;MACT,MAAMwB,KAAI,GAAI,IAAIC,KAAK,CAAC,CAAC;MACzBD,KAAK,CAACE,GAAE,GAAI,+BAA+B,IAAI,CAACrC,QAAQ,MAAM;MAC9DmC,KAAK,CAACG,MAAK,GAAI,MAAM;QACjB;QACA,IAAI,CAACnC,WAAU,GAAI,IAAI;MAC3B,CAAC;MACDgC,KAAK,CAACI,OAAM,GAAI,MAAM;QAClB;QACA,IAAI,CAACpC,WAAU,GAAI,KAAK;MAC5B,CAAC;IACL;EAEJ;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}